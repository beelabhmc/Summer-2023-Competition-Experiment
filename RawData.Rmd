---
title: "Raw Data"
author: "Marissa Douglas"
date: "2023-07-12"
output: pdf_document
---

Load Packages
```{r}
library(tidyverse)
library(ggplot2)
```

Load the CSV

```{r}
ants_wide <- read_csv("Competition experiment data - Tidy Census.csv")
```

A long data set may work best for a bar plot (geom_bar)
```{r}
# create a data set by making data long
ants <- ants_wide %>% 
  pivot_longer(c(`workers`, `soldiers`, `queen`, `winged queens`, `males`), names_to = "caste", values_to = "count")
```

Make a graph for each colony (4 graphs). Group them by type (control/treatment). Make a histogram of the count (workers + soldiers) of ants in each nest. For each bar, the aesthetic should display worker count on the bottom and soldier count on the top. Add a symbol for the presence of queens or brood.

Let's make 399's tibble
```{r}
#make a tibble of the colony's nests
pw399 <- ants %>% 
  filter(`colony name` == "PW399", nest != "dead", nest != "outside")
```

Let's graph 399. I think I need to make vectors to use a histogram. A bar plot may offer better functionality
```{r}
#bar plot attempt
#https://statisticsglobe.com/draw-grouped-barplot-in-r
#Grouped barplot using ggplot2
#Should compare the two dates in pairs, once that data is collected. I do not know how to make the bars show soldier vs worker. I do not know how to make the key specify which is control and which is competitor. 

pw399 %>% ggplot(                                      
       aes(x = nest,
           y = count,
           fill = type)) +
  geom_bar(stat = "identity",
           position = "dodge")
```

Stacking attempt

```{r}
#my attempt:
#TODO pair and add queen and brood symbol
#vector for scale fill manual
fills <- c("workers" = "darkgoldenrod1", soldiers = "mediumpurple")
# Stacked
pw399 %>% filter(caste %in% c("workers", "soldiers")) %>% 
  ggplot(aes(fill=caste, y=count, x=nest)) + 
    geom_bar(position="stack", stat="identity")+
  scale_fill_manual(values = fills)
```


Trying to use alpha to pair the data from https://stackoverflow.com/questions/12715635/ggplot2-bar-plot-with-both-stack-and-dodge
```{r}
#vector for scale fill manual
fills <- c("control" = "darkgoldenrod1", "treatment" = "mediumpurple")

pw399 %>% filter(caste %in% c("workers", "soldiers")) %>%
  group_by(type, nest) %>% 
  mutate(cum_tot = cumsum(count)) %>% 
  ggplot(aes(nest, cum_tot, fill =type)) + 
  geom_col(data = . %>% filter( caste=="workers"), position = position_dodge(width = 0.9), alpha = 1) +
  geom_col(data = . %>% filter( caste=="soldiers"), position = position_dodge(width = 0.9), alpha = 0.4) +
  geom_tile(aes(y=NA_integer_, alpha = factor(caste))) + 
  scale_alpha_manual(values = c(0.4,1))+
  scale_fill_manual(values = fills)+
  xlab("Nests")+
  ylab("Total Number of Ants")
```
